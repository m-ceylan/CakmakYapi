
@{
    ViewData["Title"] = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="content animated fadeIn" id="app">
    <div class="card">
        <div class="card-header header-elements-inline">
            <h5 class="card-title">Hakkımızda</h5>
            <div class="header-elements">
                <div class="list-icons">
                    <el-button v-if="!isEditForm" size="mini"
                               plain
                               @@click="isEditForm=true">
                        <i class="icon-plus-circle2 mr-2 "></i>
                        Ekle
                    </el-button>
                    <el-button v-else size="mini"
                               plain
                               @@click="isEditForm=false">
                        <i class="icon-arrow-left8 mr-2 "></i>
                        Listeye Dön
                    </el-button>
                </div>
            </div>
        </div>

        


        @* Table Template Start *@
        <template v-if="!isEditForm">
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th> <el-checkbox :indeterminate="isIndeterminate" v-model="checkAll" @@change="handleCheckAllChange"></el-checkbox></th>
                            <th>Başlık</th>
                            <th>Fotoğraf</th>
                            <th>Aktif</th>
                            <th style="width:200px; text-align:center;">İşlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                       
                            <tr v-for="item in items.filter(data => !search || data.title.toLowerCase().includes(search.toLowerCase()))" :key="item.id">

                                <td>
                                <el-checkbox 
                                             :label="item.id" v-model="aboutIDs" :key="item.id"><span></span></el-checkbox>
                                </td>
                                <td>{{item.title}}</td>
                                <td>
                                    <div class="demo-image">
                                        <div class="block" >
                                            <el-image style="width: 100px; height: 100px"
                                                      :src="url"
                                                     ></el-image>
                                        </div>
                                    </div>

                                </td>
                                <td> 

                                <el-checkbox 
                                             v-model="item.isActive"></el-checkbox>

                                </td>

                                <td class="text-center">
                                    <button class="btn btn-outline-info btn-sm" @@click="handleEdit(item)" title="Güncelle"><i class="icon-database-edit2"></i></button>
                                    <button class="btn btn-outline-danger btn-sm" @@click="open()"  title="Sil"><i class="icon-trash"></i></button>
                                </td>
                            </tr>
                       
                    </tbody>
                </table>
                <div class="row">
                    <div class="col-md-12 pagination mt-3 mb-3" style="display: flex; justify-content: center;">
                        <el-pagination background style="text-align:center;"
                                       layout="prev, pager, next"
                                       :total="filter.TotalCount"
                                       :page-size="filter.Take"
                                       :current-page.sync="filter.CurrentPage"
                                       @@current-change="currentPageChanged"
                                       :hide-on-single-page="true">
                        </el-pagination>


                    </div>
                </div>
            </div>
        </template>
        @* Table Template End *@

        @* Edit Template Start *@
        <template v-else>
            <div class="row">
                <div class="col-md-12">
                    <div class="card-body">
                        <input autocomplete="false" name="hidden" type="text" style="display:none;">
                        <div class="row">
                            <div class="form-group col-md-12">
                                <label> Başlık </label>
                                <el-input v-model="request.title"></el-input>

                                <span class="validation-error" v-if="response.validationErrors.some(x => x.key == 'Title')">{{ response.validationErrors.filter(x => x.key == 'Title')[0].value }}</span>
                            </div>
                        </div>
                        <div class="text-right mt-3">
                            <button v-if="updateID.replace(/\s/g, '').length > 0" type="submit" class="btn btn-warning btn-create-participant" @@click="updateItem">
                                Güncelle
                                <i class="icon-database-edit2"></i>
                            </button>

                            <button type="submit" v-else class="btn btn-primary btn-create-participant" @@click="addItem">
                                Ekle
                                <i class="icon-paperplane ml-2"></i>
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </template>
        @* Edit Template End *@
    </div>
</div>

@section Scripts{

    <script>
        
        var app = new Vue({
            el: '#app',
            data: {
                url: 'https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg',
                items:[],
                search: '',
                updateID: '',
                isEditForm: false,
                aboutIDs: [],
                isIndeterminate: true,
                checkAll:false,
                request: {
                    Id:null,
                    Title:''

                },
                filter: {
                    Skip: 0,
                    Take: 10,
                    Page: 1,
                    TotalCount: 0,
                    CurrentPage: 1,
                },
                response: {
                    validationErrors: [],
                    Data: null
                }
            },
            methods: {
                handleCheckAllChange(val) {
                   
                    this.aboutIDs = val ? this.items.map(k => k.id) : [];
                    this.isIndeterminate = false;
                },
                getData: async function () {
                    var res = (await this.$service.post('aboutM/getAbouts', {
                        ... this.filter,
                        Skip: (this.filter.CurrentPage * this.filter.Take) - this.filter.Take
                    }));

                    this.items = res.data.data.items;
                    this.filter.TotalCount = res.data.data.totalCount;

                },

                addItem: async function () {
                    this.response = (await this.$service.post('aboutM/AddAbout', this.request)).data;
                    if (!this.response.hasError) {
                        this.$message.success(this.response.message);
                    } else {
                        this.$message.error(this.response.message);
                    }

                },

                updateItem: async function () {
                    this.response = (await this.$service.post('aboutM/UpdateAbout', this.request)).data;
                    if (!this.response.hasError) {
                        this.$message.success(this.response.message);
                    } else {
                        this.$message.error(this.response.message);
                    }

                },

                handleEdit(row) {
                    this.updateID = row.id;
                    this.request = row;
                    this.isEditForm = true;
                    console.log(index, row);
                },
                handleDelete(index, row) {
                    console.log(index, row);
                    this.open();
                },
                open() {
                    this.$confirm('Bu kaydı silmek istediğine emin misin?', 'Uyarı', {
                        confirmButtonText: 'Evet',
                        cancelButtonText: 'Vazgeç',
                        type: 'warning'
                    }).then(() => {
                        this.$message({
                            type: 'success',
                            message: 'Delete completed'
                        });
                    }).catch(() => {
                        this.$message({
                            type: 'info',
                            message: 'Delete canceled'
                        });
                    });
                },
                currentPageChanged() {
                    //window.scrollToTop();
                },

                
            },

            async beforeMount() {
                this.getData();
            },
            watch: {
                'filter.Page': {
                    handler: function () {
                            this.getData();
                    }
                },
                'filter.CurrentPage': {
                    handler: function () {
                            this.getData();
                    }
                },
                'aboutIDs': function () {
                    let checkedCount = this.aboutIDs.length;
                    this.checkAll = checkedCount === this.items.length;
                    this.isIndeterminate = checkedCount > 0 && checkedCount < this.items.length;
                },


            }
        });



    </script>


} 